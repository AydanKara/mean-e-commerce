import{s as U}from"./chunk-CPN2JVP4.js";import{a as n}from"./chunk-T4ITIP7S.js";import{c as b}from"./chunk-BLI2WIQU.js";import{F as a,_ as r,ca as p,ha as u,ia as h,k as s,p as l,t as o}from"./chunk-A5AGJRWB.js";var c=class i{constructor(t){this.http=t;this.loadUserOnAppInit()}apiUrl=`${n.apiUrl}/auth`;userUrl=`${n.apiUrl}/users`;snackbar=h(U);authState=new s(null);loading=new s(!0);loadUserOnAppInit(){this.getCurrentUser().pipe(a(()=>l(null))).subscribe(t=>{this.setAuthState(t),this.setLoadingState(!1)})}setLoadingState(t){this.loading.next(t)}getLoadingState(){return this.loading.asObservable()}setAuthState(t){this.authState.next(t)}getAuthState(){return this.authState.asObservable()}login(t){return this.http.post(`${this.apiUrl}/login`,t,{withCredentials:!0}).pipe(o(e=>e.user),r(()=>{this.getCurrentUser().subscribe(e=>this.setAuthState(e))}))}register(t){return this.http.post(`${this.apiUrl}/register`,t,{withCredentials:!0})}logout(){return this.http.post(`${this.apiUrl}/logout`,{},{withCredentials:!0}).pipe(r(()=>this.setAuthState(null)))}getCurrentUser(){return this.http.get(`${this.apiUrl}/me`,{withCredentials:!0})}updateProfile(t){return this.http.patch(`${this.userUrl}/update`,t,{withCredentials:!0}).pipe(r(e=>{this.setAuthState(e)}),a(e=>{throw this.snackbar.error("Error updating profile."),e}))}getUserId(){return this.authState.getValue()?._id||null}static \u0275fac=function(e){return new(e||i)(u(b))};static \u0275prov=p({token:i,factory:i.\u0275fac,providedIn:"root"})};export{c as a};
