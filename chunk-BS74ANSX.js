import{a as fe}from"./chunk-2BYQFWPK.js";import{a as te}from"./chunk-X7KAA5KW.js";import{a as ee}from"./chunk-VE74UDV5.js";import{f as H,g as J,i as K}from"./chunk-BWLJFYGV.js";import{A as se,B as ce,C as ue,c as ie,e as p,h as re,i as ne,m as oe,n as le,p as ae,q as me,r as de,w as pe}from"./chunk-EQ3PTJBT.js";import{x as X}from"./chunk-JR3KB4OF.js";import"./chunk-VWCMHKBA.js";import"./chunk-T3Q3DASN.js";import"./chunk-T4ITIP7S.js";import"./chunk-QKMSTV2X.js";import{m as U,n as Z,q as Y,r as $}from"./chunk-SPT54WKC.js";import{$a as L,Cb as f,D,Eb as s,Ob as t,Pb as e,Qb as c,Tb as A,Yb as M,bc as I,cb as l,cc as E,db as z,e as T,ec as R,fc as G,gc as W,ia as v,jc as Q,kc as i,lb as B,lc as C,mc as j,oc as w,pc as O,qc as N,ra as _,sa as S,sc as F,u as V,vc as k,wc as P}from"./chunk-IB35DNSN.js";var ye=["checkoutForm"],ge=()=>({standalone:!0});function be(a,n){a&1&&(t(0,"p",52),i(1," Full Name must be at least 8 characters. "),e())}function ve(a,n){a&1&&(t(0,"p",52),i(1," Please enter a valid email. "),e())}function Ce(a,n){a&1&&(t(0,"p",52),i(1," Please enter a valid Country. "),e())}function _e(a,n){a&1&&(t(0,"p",52),i(1," Address must be at least 10 characters. "),e())}function Se(a,n){a&1&&(t(0,"p",52),i(1," City must be at least 4 characters. "),e())}function ke(a,n){a&1&&(t(0,"p",52),i(1," Please enter a valid ZIP or Postcode. "),e())}function Pe(a,n){a&1&&(t(0,"p",52),i(1," Phone number must be 10-15 digits. "),e())}function xe(a,n){if(a&1&&(t(0,"li",30)(1,"div",53)(2,"div",54)(3,"a",55),c(4,"img",56),e()(),t(5,"div",57)(6,"p",58)(7,"a",59),i(8),e(),c(9,"br"),t(10,"span",60),i(11),k(12,"currency"),e(),t(13,"span",61),i(14," x "),e(),t(15,"span",62),i(16),e()()()()()),a&2){let o=n.$implicit;l(3),E("routerLink","/product/",o._id,""),l(),I("src",o.images,L),I("alt",o.name),l(3),E("routerLink","/product/",o._id,""),l(),C(o.name),l(3),C(P(12,9,o.price)),l(5),C(o.quantity)}}var he=class a{constructor(n){this.fb=n;this.form=this.fb.group({fullName:["",[p.required,p.minLength(8)]],email:["",[p.required,p.email]],country:["",[p.required,p.minLength(4)]],address:["",[p.required,p.minLength(10)]],city:["",[p.required,p.minLength(4)]],zipCode:["",[p.required,p.pattern(/^\d{5}$/)]],phone:["",[p.required,p.pattern(/^[0-9]{10,15}$/)]]})}checkoutForm;cartItems=[];orderItems=[];shippingInfo={address:"",city:"",zipCode:"",country:""};user={_id:"",email:"",fullName:"",phone:""};totalPrice=0;paymentMethod="Credit Card";cartService=v(ee);orderService=v(fe);userService=v(te);snackbar=v(X);router=v(H);form;errorMessage="";subscriptions=new T;ngOnInit(){this.subscriptions.add(V([this.cartService.getCartObservable(),this.userService.getAuthState().pipe(D(n=>!!n))]).subscribe({next:([n,o])=>{this.cartItems=n.items||[],this.orderItems=this.cartItems.map(x=>({product:x,quantity:x.quantity,price:x.price})),this.totalPrice=n.totalPrice;let{_id:r,fullName:d,email:u,shippingInfo:m,phone:g}=o||{},{address:h="",city:y="",zipCode:b="",country:q=""}=m||{};this.form.patchValue({fullName:d||"",email:u||"",address:h,city:y,zipCode:b,country:q,phone:g||""}),this.shippingInfo={address:h,city:y,zipCode:b,country:q},this.user={_id:r,fullName:d||"",email:u,phone:g||""}},error:()=>{this.snackbar.error("Error loading cart or user data.")}})),this.subscriptions.add(this.form.valueChanges.subscribe(n=>{this.shippingInfo={address:n.address,city:n.city,zipCode:n.zipCode,country:n.country}}))}onSubmit(){if(this.form.valid){let n={_id:"",user:this.user,orderItems:this.orderItems,shippingInfo:this.shippingInfo,paymentMethod:this.paymentMethod,totalPrice:this.totalPrice,paymentStatus:"Pending",orderStatus:"Processing",isDelivered:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};this.orderService.createOrder(n).subscribe({next:o=>{this.snackbar.success(o.message),this.cartService.clearCart(),this.orderService.setOrderPlaced(!0),this.router.navigate(["/order-confirmation",o.order._id])},error:o=>{this.snackbar.error(o.error.message||"Order submission failed."),this.errorMessage=o.error.message||"Unknown error occurred."}})}else this.snackbar.error("Please fill in all required fields correctly.")}ngOnDestroy(){this.subscriptions.unsubscribe()}static \u0275fac=function(o){return new(o||a)(z(se))};static \u0275cmp=B({type:a,selectors:[["app-checkout"]],viewQuery:function(o,r){if(o&1&&R(ye,5),o&2){let d;G(d=W())&&(r.checkoutForm=d.first)}},decls:104,vars:25,consts:[["checkoutForm","ngForm"],[1,"pt-4","pb-5","my-6"],[1,"container"],[1,"row"],[1,"col-12","text-center"],[1,"mb-5"],[1,"col-12","col-md-7"],[3,"ngSubmit","formGroup"],[1,"mb-4","fs-5"],[1,"row","mb-5"],[1,"col-12"],[1,"form-group"],["for","fullName",1,"form-label"],["id","fullName","formControlName","fullName","type","text","placeholder","Full Name","required","",1,"form-control","form-control-sm"],["class","text-danger",4,"ngIf"],["for","email",1,"form-label"],["id","email","formControlName","email","type","email","placeholder","Email","required","",1,"form-control","form-control-sm"],["for","country",1,"form-label"],["id","country","formControlName","country","type","text","placeholder","Country","required","",1,"form-control","form-control-sm"],["for","address",1,"form-label"],["id","address","formControlName","address","type","text","placeholder","Address","required","",1,"form-control","form-control-sm"],[1,"col-12","col-md-6"],["for","city",1,"form-label"],["id","city","formControlName","city","type","text","placeholder","Town / City","required","",1,"form-control","form-control-sm"],["for","zipCode",1,"form-label"],["id","zipCode","formControlName","zipCode","type","text","placeholder","ZIP / Postcode","required","",1,"form-control","form-control-sm"],[1,"form-group","mb-0"],["for","phone",1,"form-label"],["id","phone","formControlName","phone","type","tel","placeholder","Mobile Phone","required","",1,"form-control","form-control-sm"],[1,"list-group","list-group-sm","mb-7"],[1,"list-group-item"],[1,"form-check","custom-radio"],["id","checkoutPaymentCard","name","payment","type","radio",1,"form-check-input",3,"ngModelChange","ngModel","ngModelOptions","value"],["for","checkoutPaymentCard",1,"form-check-label","fs-sm","text-body","text-nowrap"],["src","https://yevgenysim-turkey.github.io/shopper/assets/img/brands/color/cards.svg","alt","...",1,"ms-2"],["id","checkoutPaymentPaypal","name","payment","type","radio",1,"form-check-input",3,"ngModelChange","ngModel","ngModelOptions","value"],["for","checkoutPaymentPaypal",1,"form-check-label","fs-sm","text-body","text-nowrap"],["src","https://yevgenysim-turkey.github.io/shopper/assets/img/brands/color/paypal.svg","alt","..."],[1,"col-12","col-md-5","col-lg-4","offset-lg-1"],[1,"mb-4"],[1,"my-4"],[1,"list-group","list-group-lg","list-group-flush-y","list-group-flush-x","mb-3"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"card","mb-4","bg-light"],[1,"card-body"],[1,"list-group","list-group-sm","list-group-flush-y","list-group-flush-x"],[1,"list-group-item","d-flex"],[1,"ms-auto","fs-sm"],[1,"list-group-item","d-flex","fs-lg","fw-bold"],[1,"ms-auto"],[1,"mb-3","fs-xs","text-gray-500"],["type","button",1,"btn","w-100","btn-dark",3,"click","disabled"],[1,"text-danger"],[1,"row","align-items-center"],[1,"col-4",2,"height","6rem"],[3,"routerLink"],[1,"img-fluid","w-100","h-100","object-fit-cover",3,"src","alt"],[1,"col"],[1,"mb-4","fs-sm","fw-bold"],[1,"text-body",3,"routerLink"],[1,"text-muted"],[1,"fw-bold"],[1,"fw-bolder"]],template:function(o,r){if(o&1){let d=A();t(0,"section",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h1",5),i(5,"Checkout"),e()()(),t(6,"div",3)(7,"div",6)(8,"form",7,0),M("ngSubmit",function(){return _(d),S(r.onSubmit())}),t(10,"h2",8),i(11,"Billing Details"),e(),t(12,"div",9)(13,"div",10)(14,"div",11)(15,"label",12),i(16,"Full Name *"),e(),c(17,"input",13),f(18,be,2,0,"p",14),e()(),t(19,"div",10)(20,"div",11)(21,"label",15),i(22,"Email *"),e(),c(23,"input",16),f(24,ve,2,0,"p",14),e()(),t(25,"div",10)(26,"div",11)(27,"label",17),i(28,"Country *"),e(),c(29,"input",18),f(30,Ce,2,0,"p",14),e()(),t(31,"div",10)(32,"div",11)(33,"label",19),i(34,"Address *"),e(),c(35,"input",20),f(36,_e,2,0,"p",14),e()(),t(37,"div",21)(38,"div",11)(39,"label",22),i(40,"Town / City *"),e(),c(41,"input",23),f(42,Se,2,0,"p",14),e()(),t(43,"div",21)(44,"div",11)(45,"label",24),i(46,"ZIP / Postcode *"),e(),c(47,"input",25),f(48,ke,2,0,"p",14),e()(),t(49,"div",10)(50,"div",26)(51,"label",27),i(52,"Mobile Phone *"),e(),c(53,"input",28),f(54,Pe,2,0,"p",14),e()()(),t(55,"h2",8),i(56,"Payment"),e(),t(57,"div",29)(58,"div",30)(59,"div",31)(60,"input",32),N("ngModelChange",function(m){return _(d),O(r.paymentMethod,m)||(r.paymentMethod=m),S(m)}),e(),t(61,"label",33),i(62," Credit Card "),c(63,"img",34),e()()(),t(64,"div",30)(65,"div",31)(66,"input",35),N("ngModelChange",function(m){return _(d),O(r.paymentMethod,m)||(r.paymentMethod=m),S(m)}),e(),t(67,"label",36),c(68,"img",37),e()()()()()(),t(69,"div",38)(70,"h6",39),i(71),e(),c(72,"hr",40),t(73,"ul",41),f(74,xe,17,11,"li",42),e(),t(75,"div",43)(76,"div",44)(77,"ul",45)(78,"li",46)(79,"span"),i(80,"Subtotal"),e(),t(81,"span",47),i(82),k(83,"currency"),e()(),t(84,"li",46)(85,"span"),i(86,"Tax"),e(),t(87,"span",47),i(88,"$00.00"),e()(),t(89,"li",46)(90,"span"),i(91,"Shipping"),e(),t(92,"span",47),i(93,"$8.00"),e()(),t(94,"li",48)(95,"span"),i(96,"Total"),e(),t(97,"span",49),i(98),k(99,"currency"),e()()()()(),t(100,"p",50),i(101," Your personal data will be used to process your order, support your experience throughout this website, and for other purposes described in our privacy policy. "),e(),t(102,"button",51),M("click",function(){_(d);let m=Q(9);return S(m.ngSubmit.emit())}),i(103," Place Order "),e()()()()()}if(o&2){let d,u,m,g,h,y,b;l(8),s("formGroup",r.form),l(10),s("ngIf",((d=r.form.get("fullName"))==null?null:d.touched)&&((d=r.form.get("fullName"))==null?null:d.invalid)),l(6),s("ngIf",((u=r.form.get("email"))==null?null:u.touched)&&((u=r.form.get("email"))==null?null:u.invalid)),l(6),s("ngIf",((m=r.form.get("country"))==null?null:m.touched)&&((m=r.form.get("country"))==null?null:m.invalid)),l(6),s("ngIf",((g=r.form.get("address"))==null?null:g.touched)&&((g=r.form.get("address"))==null?null:g.invalid)),l(6),s("ngIf",((h=r.form.get("city"))==null?null:h.touched)&&((h=r.form.get("city"))==null?null:h.invalid)),l(6),s("ngIf",((y=r.form.get("zipCode"))==null?null:y.touched)&&((y=r.form.get("zipCode"))==null?null:y.invalid)),l(6),s("ngIf",((b=r.form.get("phone"))==null?null:b.touched)&&((b=r.form.get("phone"))==null?null:b.invalid)),l(6),w("ngModel",r.paymentMethod),s("ngModelOptions",F(23,ge))("value","Credit Card"),l(6),w("ngModel",r.paymentMethod),s("ngModelOptions",F(24,ge))("value","PayPal"),l(5),j("Order Items (",r.orderItems.length,")"),l(3),s("ngForOf",r.cartItems),l(8),C(P(83,19,r.totalPrice)),l(16),C(P(99,21,r.totalPrice)),l(4),s("disabled",r.form.invalid)}},dependencies:[$,U,Z,Y,K,J,ce,le,ie,ae,re,ne,pe,oe,ue,me,de],styles:[".card-body[_ngcontent-%COMP%]{flex:1 1 auto;padding:1.5rem}.cart-items[_ngcontent-%COMP%]{max-height:50rem;overflow-y:auto;overflow-x:hidden}.list-group[_ngcontent-%COMP%]{border-radius:0;max-height:25rem;overflow-y:auto;overflow-x:hidden}.list-group-item[_ngcontent-%COMP%]{border:1px solid #e5e5e5;display:block;padding:1.5rem;position:relative}.list-group-item[_ngcontent-%COMP%], .list-group-item-action[_ngcontent-%COMP%]:active{background-color:transparent;color:#1f1f1f}.list-group-item[_ngcontent-%COMP%] + .list-group-item[_ngcontent-%COMP%]{border-top-width:0}.list-group-sm[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{padding:1.25rem}.list-group-flush-x[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]{border-left:none;border-right:none;padding-left:0;padding-right:0}.list-group-flush-y[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]:first-child{border-top:none;padding-top:0}.list-group-flush-y[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]:last-child{border-bottom:0;padding-bottom:0}.btn-link[_ngcontent-%COMP%]{color:#1f1f1f;font-weight:500}"]})};export{he as CheckoutComponent};
